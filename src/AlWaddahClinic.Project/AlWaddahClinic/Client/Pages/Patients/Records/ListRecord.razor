@page "/patients/records/{id:int}"
@attribute [Authorize(Roles = "Admin")]

@{
    if (!string.IsNullOrEmpty(_errorMessage))
    {
        <MudAlert Severity="Severity.Error" Variant="Variant.Filled" style="padding: 1rem;">@_errorMessage!</MudAlert>
    }
}

@{
    if (_isBusy == true)
    {
        <MudGrid Class="d-flex justify-center" Style="height: 100vh; align-items: center;">
            <MudItem>
                <Loader />
            </MudItem>
        </MudGrid>
    }
    else
    {
        <MudContainer Class="mt-5">
            <MudCard Style="padding: 2rem;">
                <MudCardContent>
                    <MudText Typo="Typo.h3" Color="Color.Error"><b><i class="bi bi-journal-medical"></i> Health Record</b></MudText>
                    <MudText Typo="Typo.h6"><b>Created On: @record.CreatedOn.ToLongDateString()</b></MudText>
                    <MudText Typo="Typo.h6" Color="Color.Info" @onclick="GoBack" Style="text-decoration: underline; cursor: pointer;">@record.Patient.FullName</MudText>
                    <MudDivider />
                </MudCardContent>

                <MudCardContent>
                    <MudText Typo="Typo.h6">
                        <b>Description:</b>
                    </MudText>

                    <MudText Typo="Typo.body1">@record.Description</MudText>
                </MudCardContent>

                @if (record.Notes == null)
                {
                    <Loader />
                }
                else
                {
                    if (record.Notes.Count == 0)
                    {
                        <MudCardContent>
                            <MudText Typo="Typo.body1" Color="Color.Error">This record doesn't include any notes!</MudText>
                        </MudCardContent>
                    }
                    else
                    {
                        <MudCardContent>
                            <MudText Typo="Typo.h6"><b>Notes & Information</b></MudText>
                            @foreach (var note in record.Notes)
                            {
                                <MudText Typo="Typo.body2"><i class="bi bi-pin-angle-fill"></i> @note.Title</MudText>
                            }
                        </MudCardContent>
                    }

                }


                <MudCardContent>
                    <MudButton Variant="Variant.Outlined" Color="Color.Info" @onclick="GoBack">Go Back</MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Error" @onclick="OpenRemoveDialog">
                        Remove Record
                    </MudButton>
                </MudCardContent>
            </MudCard>
        </MudContainer>
    }
}


